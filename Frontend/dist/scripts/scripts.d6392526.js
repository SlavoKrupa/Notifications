"use strict";angular.module("Notifications",["ngAnimate","ngAria","ngWebSocket"]),angular.module("Notifications").service("webSocketFactory",["$websocket",function(a){function b(a,b){var d=JSON.parse(b.data);d.db_creation=new Date(d.db_creation),d.backend_receiving=new Date(d.backend_receiving),d.frontend_receiving=new Date;var e={source:a,DB2BE:d.backend_receiving-d.db_creation,BE2FE:d.frontend_receiving-d.backend_receiving};c(e)}var c=function(){},d=function(){},e={},f={"C#":"ws://127.0.0.1:8080/CSharp",Java:"ws://127.0.0.1:8082/java",Python:"ws://127.0.0.1:8081/Python"};return{setCallBack:function(a){if("function"!=typeof a)throw"Callback must be function.";c=a},openWs:function(c){e[c]=a(f[c]),e[c].onOpen(function(){console.log("websocket to "+c+" opened!")}),e[c].onClose(function(){console.log("websocket to "+c+" closed!"),d(c)}),e[c].onError(function(){console.log("Error on "+c+" socket!"),d(c)}),e[c].onMessage(function(a){b(c,a)})},closeWs:function(a){e[a].close(!0)},setWebSocketErrorCallback:function(a){if("function"!=typeof a)throw"Callback must be function.";d=a}}}]).controller("MainCtrl",["webSocketFactory","$scope",function(a,b){function c(a){return angular.isDefined(b.results[a])&&b.results[a].isRunning===e}b.SUPPORTED_LANGUAGES=["C#","Java","Python"],a.setCallBack(function(a){var c=b.results[a.source];c.lastOccurrences.push(a),c.lastOccurrences.length>10&&c.lastOccurrences.pop();var d=c.count+1,e=(c.averageDB2BE*c.count+a.DB2BE)/d,f=(c.averageBE2FE*c.count+a.BE2FE)/d;c.count=d,c.averageBE2FE=f,c.averageDB2BE=e}),a.setWebSocketErrorCallback(function(a){b.results[a].isRunning=d});var d="btn-danger",e="btn-success";b.results={},b.clearData=function(){angular.forEach(b.SUPPORTED_LANGUAGES,function(a){b.results[a]={isRunning:c(a)?e:d,count:0,averageDB2BE:0,averageBE2FE:0,lastOccurrences:[]}})},b.clearData(),b.switchWebsocket=function(f){var g=c(f);g?(a.closeWs(f),b.results[f].isRunning=d):(a.openWs(f),b.results[f].isRunning=e)}}]),angular.module("Notifications").run(["$templateCache",function(a){a.put("views/main.html",'<div class="container"> <div class="row"> <span class="col-md-2" ng-repeat="language in SUPPORTED_LANGUAGES "> <button class="btn" ng-class="[results[language].isRunning]" ng-click="switchWebsocket(language)"> <i class="glyphicon glyphicon-off"></i> {{language}}</button> </span> <span class="col-md-2"> <button class="btn btn-warning" ng-click="clearData()"> <i class="glyphicon glyphicon-trash"></i> Clear Data</button> </span> </div> </div> <h1>Performance comparison</h1> <div class="row marketing"> <table class="table table-hover"> <tr> <td><i class="glyphicon glyphicon-dashboard"></i> </td> <td>C#</td> <td>Python</td> <td>Java</td> </tr> <tr> <td>Average database to backend (ms)</td> <td>{{results[\'C#\'].averageDB2BE | number:2}}</td> <td>{{results[\'Python\'].averageDB2BE | number:2}}</td> <td>{{results[\'Java\'].averageDB2BE| number:2}}</td> </tr> <tr> <td>Average backend to frontend (ms)</td> <td>{{results[\'C#\'].averageBE2FE| number:2}}</td> <td>{{results[\'Python\'].averageBE2FE| number:2}}</td> <td>{{results[\'Java\'].averageBE2FE| number:2}}</td> </tr> <tr> <td>Total count</td> <td>{{results[\'C#\'].count}}</td> <td>{{results[\'Python\'].count}}</td> <td>{{results[\'Java\'].count}}</td> </tr> </table> </div>')}]);